(function(e){e(function(){e.fn.center=function(){this.css("top",Math.max(0,(e(window).height()-e(this).outerHeight())/2+e(window).scrollTop())+"px");this.css("left",Math.max(0,(e(window).width()-e(this).outerWidth())/2+e(window).scrollLeft())+"px");return this};var t=function(){e("html, body").animate({scrollTop:e("#masthead").offset().top},100)};_.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g};var n={};_.extend(n,Backbone.Events);var r=Backbone.View.extend({el:"#content",initialize:function(){},fetchPosts:function(e){var t=this;this.collection=new wp.api.collections.Posts;this.collection.fetch({data:{page:e},success:function(n,r,i){t.totalPages=i.xhr.getResponseHeader("X-WP-TotalPages");t.total=i.xhr.getResponseHeader("X-WP-Total");t.currentPage=e;t.render()}})},render:function(){var n=e("#home-view").html();n=_.template(n,{posts:this.collection.models,pages:this.totalPages,total:this.total,currentPage:this.currentPage});e(this.el).html(n);t()}}),i=Backbone.View.extend({el:"#content",initialize:function(){},events:{"submit #commentform":"submitComment"},submitComment:function(t){t.preventDefault();var n=[],r=this,i=!1,s=e(t.currentTarget),o=s.find("textarea#comment").val();s.find(".error").remove();var a=[".comment-form-author",".comment-form-email",".comment-form-comment"];e.each(a,function(t,n){e(n).removeClass("invalid")});if(wedevsBackbone.loggedin==="no"){var f=s.find("input#email").val(),l=s.find("input#author").val();if(l===""){i=!0;s.find(".comment-form-author").addClass("invalid").append('<div class="error">Error: please type a comment.</div>')}if(f===""){i=!0;s.find(".comment-form-email").addClass("invalid").append('<div class="error">Error: please type a comment.</div>')}}if(o===""){i=!0;s.find(".comment-form-comment").addClass("invalid").append('<div class="error">Error: please type a comment.</div>')}if(!i){var c=s.serialize()+"&action=wpbb_new_comment";e.post(wedevsBackbone.ajaxurl,c,function(e){e.success===!1?alert(e.data):(new u).initComments(r.model)})}},fetchPost:function(e,t){self=this;self.type=t;this.model=new wp.api.models.Post({ID:e});this.model.fetch({success:function(){self.render()}})},render:function(){if(this.type==="post")var r=e("#single-post-view").html();else var r=e("#single-page-view").html();r=_.template(r,{post:this.model});e(this.el).html(r);n.trigger("post:single:"+this.type,this.model);t()}}),s=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:0,post:0,contnt:"",parent:0,date:"",links:{},author:{name:"",URL:"",avatar:""}}}),o=Backbone.Collection.extend({model:s,url:function(){return wpApiOptions.base+"/posts/"+this.post.id+"/comments"},comparator:function(e){return e.get("date")},initialize:function(e){this.post=e}}),u=Backbone.View.extend({initialize:function(){this.el="#comments";n.once("post:single:post",this.initComments,this)},initComments:function(e){var t=this;t.post=e;this.collection=new o(e);this.collection.fetch({success:function(){t.render()}})},render:function(){var t=e("#comments-view").html();t=_.template(t,{comments:this.collection.models,post:this.post});e(this.el).html(t)}}),a=Backbone.Router.extend({routes:{"/":"home","posts/:id/*slug":"singlePost","page/:id/*slug":"singlePage","page/:id/*slug/*slug":"singlePage","p/:id":"paged","*actions":"home"},singlePost:function(e,t){(new i).fetchPost(e,"post");new u},singlePage:function(e){(new i).fetchPost(e,"page")},home:function(){(new r).fetchPosts(1)},paged:function(e){(new r).fetchPosts(e)}}),f=new a;Backbone.history.start();e(".loading").center();e.ajaxSetup({beforeSend:function(t){e(".loading").show()},complete:function(){e(".loading").hide()}})})})(jQuery);